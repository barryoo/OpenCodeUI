FROM nginx:1.27-alpine

RUN apk add --no-cache python3 py3-pip docker-cli

WORKDIR /app

COPY docker/router/requirements.txt /app/requirements.txt
RUN pip3 install --no-cache-dir -r /app/requirements.txt

COPY docker/router /app/router

COPY docker/nginx.gateway.conf /etc/nginx/http.d/default.conf

EXPOSE 6658

CMD ["/bin/sh", "-c", "python3 /app/router/router.py & nginx -g 'daemon off;' "]
